# 16일차-220124

# 이전 강의내용 리뷰

grep의 정규표현식

- 정규표현식에 사용되는 문자 : . , * , ^ , $
- . : .에는 임의 문자 1개가 들어갈 수 있다.
    - grep "c.t" fileA
- : 임의 문자가 여러개 들어갈 수 있다.
    - grep "c*t" fileA
- ^ : 문자열 제일 앞부분
    - grep "^cat" fileA
- $ : 문자열 제일 뒷부분
    - grep "cat$" fileA

---

vi 에디터 사용시 주의사항

- Ctrl + c, Ctrl + z 등을 사용하면 안됨
- 만약 위의 단축키를 사용하여 인터럽트가 걸렸다면 pid를 찾아서 kill
- 스왑파일(원본파일 경로에 .로 시작하는 파일)이 생성되었다면 삭제

---

tee의 활용

- 일반 사용자로 작업시 리다이렉션이 불가한 경우 sudo 명령어와 함께 사용

---

튜닝 프로파일

- 시스템 사용 사례에 따라 설정을 조정해 성능 최적화 가능
- 시스템 관리자가 직접 세부적인 조절 가능(어려움)
- 간단한 제어가 가능한 관리 도구 제공 -> tuned데몬
- 기본적인 구성이 만들어진 튜닝 프로파일 제공
- 원하는 사용 방식에 맞는 프로파일 선택 시 해당 구성 제공
- tuned-adm 명령 사용

---

사용자 관리

- root 사용자	: 대부분의 시스템 관리 작업 수행 시 사용 (sudo)	uid:0
- 시스템 사용자:	uid:1~999
- 일반 사용자	: 권한이 미치는 범위 안에서의 작업만 가능	uid:1000~
- 기본그룹	: 생성할 때부터 지정하는 유일한 그룹
- 보조그룹	:
- ACL	: 파일 소유자, 소유그룹, 기타사용자 외의 사용자나 그룹에 세부 설정 적용하기 위해 사용

---

저장소 관련

하드디스크 파티셔닝에 대해서 다시 알아두기

논리볼륨

- 디스크 여러개를 통합/하나의 공간을 분할 해서 유연한 사용 가능 => 사이즈 확장 가능(+@로 복제, 분산 기능)

---

네트워크 설정

- nmcli로 설정 변경 시 nmcli con reload 로 변경 설정 적용
- 항상 nmcli con up 으로 활성화 필수
- systemctl restart network 와 systemctl restart NetworkManager는 다름!

---

SSH

- 키기반 인증 설정 시 패스워드 없이 접속 가능 => 자동화를 위해서 굉장히 중요함
    - 편의성 : 패스워드 입력이 없다
    - 안전성 : 키 길이가 길고 접속 대상 제한이 가능해 보안성이 좋다

---

## NTP 서버 관리

### NTP (Network Time Protocol)

- 네트워크를 이용해 시간을 동기화 하는 방식
- ms(millisecond) 이내의 범위에서 시간정보를 정확하게 교정

### NTP의 사용 목적

- 정확한 시각을 설정하기 위해 NTP를 사용
- 각 시스템들의 시각을 동일하게 설정 (인증이나 기타 여러가지 부분에서 문제발생 가능)
- 시스템 분석 시 영향을 끼치지 않기 위해(로그의 timestamp가 달라질 수 있기에)

### NTP의 계층

- 계층이 높을수록 시간이 정확
- 0번은 원자시계 / GPS 등의 장비
- 각 계층의 서버는 하위 계층의 서버에 데이터(시간정보)를 전달

### chrony

- 최신버전 리눅스에서 NTP서비스를 대체하는 시간 동기화 서비스
- /etc/chrony.conf 설정파일 또는 chronyc 명령어 등으로 설정 변경 가능

### chrony 설정 방법

1. chronyd 서비스를 활성화 -> systemctl 또는 timedatectl 명령어로 설정
2. /etc/chrony.conf 파일에서 주소 및 설정값 설정
3. 필요 시 chronyd 서비스 재시작
4. chronyc 명령어로 변경된 설정 확인

### NTP 실습

1. 브라우저로 NTP서버 검색 후 하나 성택
2. 해당 주소를 추가하고 확인
3. 나머지 주소 (기본주소) 주석처리 후 확인

---

## 방화벽

### 방화벽 관리

- 외부적으로 네트워크를 통해서 전달하는 패킷을 처리하는 방식을 결정
- 시스템 외부에 별도의 장비로 존재할 수 있음
- 시스템 자체적으로 방화벽 규칙 설정이 필요
- CentOS 의 경우 firewalld 라는 서비스를 이용해서 규칙 제어
- firewall-cmd 명령어를 이용해서 설정 (firewall-config 라는 그래픽 도구도 사용 가능)

### firewalld 서비스의 특징 (장점)

- 사용자 공간에서의 설정 방식 제공
- 서비스 이름에 대한 포트매핑 설정 제공
- 여러 가지 영역을 제공 (각 영역 별 기본 규칙 미리 설정)
- iptables와 달리 규칙을 변경해도 서비스를 재시작할 필요가 없다. (중요한 장점)
- 한번에 여러개 설정할 경우는 중괄호로 묶어서 설정
    - ex) firewall-cmd --remove-service={http,https}

### 방화벽 설정 실습

1. 기본 영역에 대한 확인
    - virtualbox 에서 네트워크 인터페이스를 하나 더 추가 (가상머신 종료 후 추가)
    - 현재 기본영역을 확인하고 work 영역을 기본영역으로 변경 (set-default/get-default 사용)
    - virtualbox 에서 네트워크 인터페이스를 하나 더 추가
2. 서비스 규칙 확인 (각 설정은 확인까지 할것)
    - 기본영역(work)에서 http 와 https 를 허용하도록 설정 (런타임/영구 모두)
    - 기본영역에서 nfs를 런타임만 허용하도록 설정
    - public 영역에 http를 허용하도록 영구 설정
3. 포트 규칙 설정
    - 기본 영역에서 53번 포트를 허용하도록 영구설정하세요 (tcp/udp 모두)
    - public 영역에서 3260/tcp 포트를 허용하도록 런타임설정
4. 인터페이스 변경 ( 옵션에서 change/add/remove interface 사용)
    - 각 영역의 규칙을 확인해서 영역 별로 인터페이스 할당 정보를 확인
    - 인터페이스 하나를 internal 영역의 규칙을 사용하도록 영역을 변경
    - 인터페이스 하나는 영역에서 제거

### NAT : Network Address Translation
NAPT : + Port

### 포트포워딩

- 포트번호를 이용해서 외부에서도 내부의 시스템으로 접근 가능한 경로를 제공
- 접근하는 포트와 실제 사용하는 다른 포트를 연결하기 위해 사용
    - 같은 시스템에서 다른 포트로 전달
    - 서로 다른 시스템에 동일 포트로 전달
    - 서로 다른 시스템의 다른 포트로 전달

### 마스커레이딩

- 내부에서 외부로 요청은 가능하지만 외부에서 내부로 직접 접근은 불가능한 방식
- 시스템을 숨기기 위해 사용 (보안을 위해 접근 제한)

### 리치규칙

- 모든 규칙을 좀 더 세밀하게(유연하게) 설정
- chmod - ACL의 관계와 유사함

### 포트포워딩 실습

- 가상머신을 복제해서 3개 준비
- IP 주소 설정 ( A : 10.0.2.10, B : 10.0.2.20, C : 10.0.2.30 )
- B 시스템에서 포트포워딩 설정 ( 10.0.2.20 주소의 22번 포트로 접근하면 10.0.2.30 주소를 사용하는 시스템의 22번 포트로 전달)
- A 시스템에서 ssh 명령어로 B 시스템의 주소를 지정했을 때, C 시스템으로 접속되는것을 확인

### firewall-cmd

- --add-service
- --add-port
- --add-source ... : 규칙 추가
- --add-rich-rule : 세밀한 규칙 설정 (man firewalld.richlanguage 에서 사용방법 참조)
- --remove ... : 규칙 제거
- --list-all : 확인